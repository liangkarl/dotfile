# Global tmux setting

## Command Table
# | short  | full command      |
# |--------+-------------------|
# | set    | set-option        |
# | setw   | set-window-option |
# | bind   | bind-key          |
# | unbind | unbind-key        |

## containers:
# session > window > pane

# erase all keybinds
# unbind -a

set -g prefix `				# set '`' as prefix key

# solve colorized issue in tmux
# For nvim :checkhealth setting
set -g default-terminal "xterm-256color"
set -ga terminal-overrides ",*256col*:Tc"
# set -g default-terminal "screen-255color"
# set -g default-terminal "tmux-256color"

set -g base-index 1			# set window index to 1
set -g pane-base-index 1	# set pane index to 1
set -g history-limit 20000	# scroll history size
setw -g mode-keys vi		# set copy-mode to vi style
setw -g automatic-rename	# rename window automately
set -sg escape-time 0		# no waiting time
set -g focus-events on		# Used for vim-tmux-clipboard
setw -g monitor-bell on		# monitor bell in the window
setw -g visual-bell on		# show visual alert when task complete
setw -g bell-action other	# only other, not current window, triggers bell

# Add alias for split-window
set -s command-alias[10] vs='split-window -h'
set -s command-alias[11] hs='split-window -v'

## Key mapping
bind ` send-prefix			# press '`' twice => '`'
bind a last-window
bind r move-window -r		# sort the windows

# create a window next to current one
bind c new-window -a -c "#{pane_current_path}"
bind \\ split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# select next pane
bind n select-pane -Z -t :.+
# select previous pane
bind p select-pane -Z -t :.-

# to next window
bind -r Tab next
# Shift+Tab: to previous window
bind -r BTab prev

# sort the sessions by name
bind s choose-tree -sZ -O name

# open debug ide
debug_console="${XDG_CONFIG_HOME}/tmux/tools/debug-console"
bind o run-shell ${debug_console}

# search history above
bind j copy-mode \; send-key ?

# open float terminal
fterm="${XDG_CONFIG_HOME}/tmux/tools/float-term"
bind Space run-shell ${fterm}

## Plugins
# List of plugins
# Other examples:
# set -g @plugin 'github_username/plugin_name'
# set -g @plugin 'git@github.com:user/plugin'
# set -g @plugin 'git@bitbucket.com:user/plugin'
tpm_dir="$XDG_CONFIG_HOME/tmux/plugins/tpm"
tpm_url='https://github.com/tmux-plugins/tpm'
flag='~/.tpm-first-run'

if "test ! -d ${tpm_dir}" \
    "run 'git clone --depth=1 $tpm_url $tpm_dir \
             && ${tpm_dir}/bin/install_plugins; \
             touch ${flag}'"

msg='display-message -p "press Leader + I to install other plugins" ; \
         set-hook -gu session-created ;'
if "test -f ${flag}" \
    "run 'rm -f ${flag}'; set-hook -g session-created '${msg}'"

# TPM(tmux plugin manager) itself
set -g @plugin 'tmux-plugins/tpm'

# Prefix + I to install these plugins
set -g @plugin 'tmux-plugins/tmux-sensible' # Make tmux more sensible
set -g @plugin 'tmux-plugins/tmux-sessionist' # more keymap for session
set -g @plugin 'tmux-plugins/tmux-yank'	# copied text could be used outside

set -g @plugin 'IngoMeyer441/tmux-easy-motion'
set -g @easy-motion-prefix 'J'
set -g @easy-motion-target-keys "fjdkslaghrueiwoqptyvncmxzb1234567890"
set -g @easy-motion-default-motion "bd-w"
set -g @easy-motion-dim-style "fg=colour242"
set -g @easy-motion-highlight-style "fg=colour196,bold"
set -g @easy-motion-highlight-2-first-style "fg=brightyellow,bold"
set -g @easy-motion-highlight-2-second-style "fg=yellow,bold"

## Themes
# Dracula: https://draculatheme.com/tmux
set -g @plugin 'dracula/tmux'
# '*' -> current pane, '-' -> previous window, '!' -> bell
set -g @dracula-show-flags true
set -g @dracula-show-left-icon session

# show dracula plugins
# available plugins:
# battery, cpu-usage, gpu-usage, ram-usage, network, network-bandwith,
# weather, time
set -g @dracula-plugins "cpu-usage ram-usage"
set -g @dracula-show-battery false
set -g @dracula-show-network false
set -g @dracula-show-weather false
set -g @dracula-show-time false
set -g @dracula-day-month false
set -g @dracula-ram-usage false
set -g @dracula-cpu-usage false
set -g @dracula-refresh-rate 5

# tmux-gruvbox: https://github.com/egel/tmux-gruvbox
# Good theme, but need more customization
# set -g @plugin 'egel/tmux-gruvbox'
# set -g @tmux-gruvbox 'dark' # or 'light'

# FIXME: WA(?) for WSL2
# https://github.com/microsoft/WSL/issues/5931
set -g escape-time 50

# Initialize TPM (keep this line at the very bottom of tmux.conf)
# run-shell '-b' is for background process.
# go into tmux and wait for applied changes are async
guide='https://github.com/tmux-plugins/tpm'
err="Fail to launch tmux plugin manager (${tpm_dir}/tpm)."
msg="Reference ${guide} for detailed information."
run -b "${tpm_dir}/tpm || echo \"${err} ${msg}\""

## Plugins note
# 1. https://github.com/roosta/tmux-fuzzback
# too slow to open fzf (in local NB)
