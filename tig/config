#
# The config is focused on the TUI based git tool,
# not full functional support of git.
#
# Config reference
# https://github.com/jonas/tig/blob/master/tigrc
# https://jonas.github.io/tig/doc/tigrc.5.html

# used for boosting loading speed
set main-options = -n 20000
set diff-options = --patience
set log-options  = --patience -p

set commit-order = default
set main-view-commit-title-graph = v1
set refresh-mode = after-command

# Addjust the column width of author
set main-view = line-number:no,interval=5 \
                date:custom,format="%m/%d/%y %H:%M" date:relative-compact \
                author:full,width=15 id:yes \
                commit-title:yes,graph,refs,overflow=no
set blame-view = id:yes,color date:relative-compact \
                 file-name:no author:abbreviated \
                 line-number:yes,interval=1 text
set refs-view = line-number:no \
                date:custom,format="%m/%d/%y %H:%M" date:relative-compact \
				ref id:yes,color commit-title
set tree-view = line-number:no,interval=5 id:yes,color \
                mode author:full file-size \
                date:custom,format="%m/%d/%y %H:%M" date:relative-compact \
                file-name

# Unbind keys {
bind generic f none
bind generic g none
bind generic y none
bind generic r none
bind generic l none
bind generic L none
bind generic d none
bind generic m none
bind generic s none
bind generic S none
bind generic , none
bind generic p none
bind generic q none
bind generic b none
bind generic o none
bind generic w none
bind generic t none
bind generic <Ctrl-C> none
bind generic - none
# }

# Views {
## Functional
bind generic 0  view-main
bind generic 9  view-reflog
bind generic 8  view-log
bind generic 1  view-status
bind generic 2  view-refs
bind generic 3  view-stash
bind generic B  view-blame
bind generic T  view-tree
bind generic -g view-grep
bind generic H  view-help

bind stage   1  none
bind stage   2  none
bind main    H  view-help

# 0 -> 1 -> 2 -> 3 -> 8 -> 9 -> 0
# main -> status -> refs -> stash -> log -> reflog -> main
bind main   , view-status
bind status , view-refs
bind refs   , view-stash
bind stash  , view-log
bind log    , view-reflog
bind reflog , view-main

bind main   . view-reflog
bind reflog . view-log
bind log    . view-stash
bind stash  . view-refs
bind refs   . view-status
bind status . view-main

bind tree   , view-blob
bind blob   , view-blame
bind blame  , view-tree

bind tree   . view-blame
bind blame  . view-blob
bind blob   . view-tree

## Blame format
bind blame -<ENTER> <tig blame -w -C -C -C %(file)
bind blame -f       <tig --no-merges -- %(file)
bind blame =        <tig blame %(file)

## Diff format
bind diff  -<ENTER> :set diff-options = --patience --ignore-all-space --ignore-blank-lines --ignore-cr-at-eol --ignore-space-at-eol --ignore-space-change
bind diff  -f       <tig --no-merges -- %(file)
bind diff  -b       <tig blame %(file)
bind diff  =        <tig show %(commit)

## Stage format
bind stage -<ENTER> :set diff-options = --patience --ignore-all-space --ignore-blank-lines --ignore-cr-at-eol --ignore-space-at-eol --ignore-space-change
bind stage -f       <tig --no-merges -- %(file)
bind stage -b       <tig blame %(file)
bind stage =        <tig

## Main format
bind main  -<ENTER> <tig --no-merges
bind main  -a       <tig --no-merges --author="%(prompt search author name: )"
bind main  =        <tig

## tree/blob format
bind blob  -f       <tig --no-merges -- %(file)
bind tree  -f       <tig --no-merges -- %(file)

# Log format
bind log   -<ENTER> :set log-options = --patience -p --no-merges --ignore-all-space --ignore-blank-lines --ignore-cr-at-eol --ignore-space-at-eol --ignore-space-change
bind log   -a       <tig log --no-merges --author="%(prompt search author name: )"
bind log   -f       <tig log -- "%(file)"
bind log   =        <tig log

## Options
bind generic o  none
bind generic os :toggle sort-field
bind generic od :toggle date
bind generic oa :toggle author
bind generic oi :toggle id
bind generic og :toggle graph
bind generic of :toggle file-name
bind generic oF :toggle file-filter
bind generic op :toggle ignore-space
bind generic or :toggle commit-title-refs
# }

# Misc {
## Move light bar to top/button
bind generic g  none
bind generic gg move-first-line
bind generic G  move-last-line
bind main    G  move-last-line

bind generic l  enter
bind generic h  view-close-no-quit
bind generic q  view-close-no-quit
bind generic J  next
bind generic K  previous
bind diff    l  scroll-right
bind diff    h  scroll-left
bind stage   l  scroll-right
bind stage   h  scroll-left
bind generic Q  quit
bind generic <Ctrl-r> <tig

bind generic ;  +git rev-parse --show-toplevel

bind generic yy +sh -c 'tig.run copy %(commit)'
bind generic yf +sh -c 'tig.run copy %(file)'
# }

# TODO:
# c: commit
# s: stash
# b: branch
# t: tag
# p: patch / push / pull / fetch
# r: rebase / merge

# Feature {
## Commit
bind generic c        none
bind main    c<ENTER> >git commit -v
bind main    ca       >?git commit -v --amend
bind main    cn       @?git commit --amend --no-edit
bind stage   c<ENTER> >git commit -v
bind stage   ca       >?git commit -v --amend
bind stage   cn       @?git commit --amend --no-edit
bind status  c<ENTER> >git commit -v
bind status  ca       >?git commit -v --amend
bind status  cn       @?git commit --amend --no-edit

## Stage/Unstage file
bind stage   f<Enter> @sh -c 'tig.run stage_file "%(file)"'
bind stage   fa       @sh -c 'tig.run stage_file'

## Add stash
bind main    sa       @git stash save "%(prompt new stash: )"
bind main    s<Enter> @sh -c 'tig.run stash'
bind main    sp       @sh -c 'tig.run cmd stash pop stash@{0}'
bind stage   sa       @git stash save "%(prompt new stash: )"
bind stage   s<Enter> @sh -c 'tig.run stash'
bind stage   sp       @sh -c 'tig.run cmd stash pop stash@{0}'
bind status  sa       @git stash save "%(prompt new stash: )"
bind status  s<Enter> +sh -c 'tig.run stash'
bind status  sp       +sh -c 'tig.run cmd stash pop stash@{0}'

## Add/Remove/Move tag and branch
bind main   ta       @sh -c 'tig.run cmd tag "%(prompt new tag: )" %(commit)'
bind main   t<ENTER> @sh -c 'tig.run cmd tag tag.$(git rev-parse --short %(commit)) %(commit)'
bind main   ba       @sh -c 'tig.run cmd branch "%(prompt new branch: )" %(commit)'
bind main   b<ENTER> @sh -c 'tig.run cmd branch branch.$(basename $(git rev-parse --show-toplevel)) %(commit)'
bind main   a<ENTER> @sh -c 'tig.run add "%(commit)"'
bind main   d<ENTER> @sh -c 'tig.run del "%(commit)"'
bind reflog ta       @sh -c 'tig.run cmd tag "%(prompt new tag: )" %(commit)'
bind reflog t<ENTER> @sh -c 'tig.run cmd tag tag.$(git rev-parse --short %(commit)) %(commit)'
bind reflog ba       @sh -c 'tig.run cmd branch "%(prompt new branch: )" %(commit)'
bind reflog b<ENTER> @sh -c 'tig.run cmd branch branch.$(basename $(git rev-parse --show-toplevel)) %(commit)'
bind reflog a<ENTER> @sh -c 'tig.run add "%(commit)"'
bind reflog d<ENTER> @sh -c 'tig.run del "%(commit)"'
bind diff   ta       @sh -c 'tig.run cmd tag "%(prompt new tag: )" %(commit)'
bind diff   t<ENTER> @sh -c 'tig.run cmd tag tag.$(git rev-parse --short %(commit)) %(commit)'
bind diff   ba       @sh -c 'tig.run cmd branch "%(prompt new branch: )" %(commit)'
bind diff   b<ENTER> @sh -c 'tig.run cmd branch branch.$(basename $(git rev-parse --show-toplevel)) %(commit)'
bind diff   a<ENTER> @sh -c 'tig.run add "%(commit)"'
bind diff   d<ENTER> @sh -c 'tig.run del "%(commit)"'
bind refs   ta       @sh -c 'tig.run cmd tag "%(prompt new tag: )" HEAD'
bind refs   t<ENTER> @sh -c 'tig.run cmd tag tag.$(git rev-parse --short HEAD) HEAD'
bind refs   ba       @sh -c 'tig.run cmd branch "%(prompt new branch: )" HEAD'
bind refs   b<ENTER> @sh -c 'tig.run cmd branch branch.$(basename $(git rev-parse --show-toplevel)) HEAD'
bind refs   a<ENTER> @sh -c 'tig.run add "%(commit)"'
bind refs   d<ENTER> @sh -c 'tig.run del "%(commit)"'

## Checkout
bind main   co +sh  -c 'tig.run cmd checkout %(commit)'
bind refs   co +sh  -c 'tig.run cmd checkout %(ref)'
bind refs   cd +sh  -c 'tig.run cmd checkout -d %(ref)'
bind reflog co +sh  -c 'tig.run cmd checkout %(commit)'
bind status co +?sh -c 'tig.run cmd checkout %(file)'
bind stage  co +?sh -c 'tig.run cmd checkout %(file)'
bind diff   co +?sh -c 'tig.run cmd checkout %(file)'

### File Operation
bind main   dc       +?sh -c 'tig.run cmd clean -fd'
bind status d<Enter> @?rm -rf %(file)
bind status dd       @?sh -c 'rm -rf $(dirname %(file))'
bind status dc       +?sh -c 'tig.run cmd clean -fd'
bind stage  d<Enter> @?rm -rf %(file)
bind stage  dd       @?sh -c 'rm -rf $(dirname %(file))'
bind stage  dc       +?sh -c 'tig.run cmd clean -fd'
bind diff   d<Enter> @?rm -rf %(file)
bind diff   dd       @?sh -c 'rm -rf $(dirname %(file))'

## Reset commits
bind main    rh +sh -c '[[ "%(prompt enter "y" to hard reset: )" == "y" ]] && git reset --hard %(commit)'
bind reflog  rh +sh -c '[[ "%(prompt enter "y" to hard reset: )" == "y" ]] && git reset --hard %(commit)'
bind diff    rh +sh -c '[[ "%(prompt enter "y" to hard reset: )" == "y" ]] && git reset --hard %(commit)'
bind main    rs +sh -c '[[ "%(prompt enter "y" to soft reset: )" == "y" ]] && git reset %(commit)'
bind reflog  rs +sh -c '[[ "%(prompt enter "y" to soft reset: )" == "y" ]] && git reset %(commit)'
bind diff    rs +sh -c '[[ "%(prompt enter "y" to soft reset: )" == "y" ]] && git reset %(commit)'
bind stage   rn +sh -c '[[ "%(prompt enter "y" to hard reset HEAD: )" == "y" ]] && git reset --hard'
bind main    rn +sh -c '[[ "%(prompt enter "y" to hard reset HEAD: )" == "y" ]] && git reset --hard'
bind main    rp +sh -c '[[ "%(prompt enter "y" to hard reset HEAD@{1}: )" == "y" ]] && git reset HEAD@{1}'

## Cherry-pick
bind main   cp +sh -c 'tig.run cmd cherry-pick -s %(commit)'
bind refs   cp +sh -c 'tig.run cmd cherry-pick -s %(commit)'
bind reflog cp +sh -c 'tig.run cmd cherry-pick -s %(commit)'
bind diff   cp +sh -c 'tig.run cmd cherry-pick -s %(commit)'

## Format patch {
bind main   ps       @sh -c 'tig.run choose patch %(commit)'
bind main   p<Enter> +sh -c 'tig.run patch.create'
bind main   p1       +sh -c 'tig.run cmd format-patch -k --binary --histogram -o .patch -1 %(commit)'
bind main   pn       +sh -c 'tig.run cmd format-patch -k --binary --histogram -o .patch %(commit)^'
bind main   pr       @sh -c 'tig.run patch.reset'
bind diff   ps       @sh -c 'tig.run choose patch %(commit)'
bind diff   p<Enter> +sh -c 'tig.run patch.create'
bind diff   p1       +sh -c 'tig.run cmd format-patch -k --binary --histogram -o .patch -1 %(commit)'
bind diff   pn       +sh -c 'tig.run cmd format-patch -k --binary --histogram -o .patch %(commit)^'
bind diff   pf       +sh -c 'tig.run cmd format-patch -k --binary --histogram -o .patch %(commit) %(file)'
bind diff   pr       @sh -c 'tig.run patch.reset'
bind log    ps       @sh -c 'tig.run choose patch %(commit)'
bind log    p<Enter> +sh -c 'tig.run patch.create'
bind log    p1       +sh -c 'tig.run cmd format-patch -k --binary --histogram -o .patch -1 %(commit)'
bind log    pn       +sh -c 'tig.run cmd format-patch -k --binary --histogram -o .patch %(commit)^'
bind log    pf       +sh -c 'tig.run cmd format-patch -k --binary --histogram -o .patch %(commit) %(file)'
bind log    pr       @sh -c 'tig.run patch.reset'
bind reflog ps       @sh -c 'tig.run choose patch %(commit)'
bind reflog p<Enter> +sh -c 'tig.run patch.create'
bind reflog p1       +sh -c 'tig.run cmd format-patch -k --binary --histogram -o .patch -1 %(commit)'
bind reflog pr       @sh -c 'tig.run patch.reset'
bind blame  p1       +sh -c 'tig.run cmd format-patch -k --binary --histogram -o .patch -1 %(commit)'
bind stage  p1       @sh -c 'tig.run cmd diff --output=$(date +%y%m%d%H%M%S).diff --binary --histogram'
bind stage  pf       @sh -c 'tig.run cmd diff --output=$(date +%y%m%d%H%M%S)_$(basename %(file)).diff --binary --histogram %(file)'
# }

# Stage {
bind stage A stage-update-part
bind stage a stage-update-line
# }

# Status {
bind status C none
bind status ! none
# }

# Reference {
bind refs C none
bind refs ! none

bind refs s<ENTER> :!sh -c 'tig.run save "%(commit)" "%(branch)" "%(refname)" "%(tag)" "%(file)"'
bind refs f<ENTER> :!sh -c 'tig.run cmd fetch --prune --all'
bind refs m<ENTER> :!sh -c 'tig.run cmd.rcv merge %(commit)'
bind refs rb       :!sh -c 'tig.run cmd.rcv rebase %(commit)'
bind refs su       !sh -c 'tig.run choose push %(commit) %(refname)'
bind refs cs       +sh -c 'tig.run choose clean'
# }

# Main {
bind main C none
bind main ! none

bind main bs +sh -c 'tig.run cmd bisect start'
bind main bg +sh -c 'tig.run cmd bisect good %(commit)'
bind main bb +sh -c 'tig.run cmd bisect bad %(commit)'
bind main br +sh -c 'tig.run cmd bisect reset'
bind main rv +sh -c 'tig.run cmd.rcv revert --no-edit %(commit)'
bind diff rv +sh -c 'tig.run cmd.rcv revert --no-edit %(commit)'
bind main rb >?git rebase -i %(commit)
bind main ra >?git rebase --abort
bind main rc >?git rebase --continue
bind main su !sh -c 'tig.run choose push %(commit) %(refname)'
bind main sm +sh -c 'tig.run choose merge %(commit) %(refname)'
bind main sr +sh -c 'tig.run choose rebase %(commit) %(refname)'
bind main sc +sh -c 'tig.run choose clean'
bind main <SingleQuote> :!sh -c 'printf -- "-- Commit Statistics --\\n\\nCommit\\tAuthor\\n"; git shortlog --summary --numbered --all --no-merges'
# }

# Log {
# }

# Reflog {
bind reflog C none
bind reflog ! none
# }

# Pager {
bind pager <Space> view-close-no-quit
# }
